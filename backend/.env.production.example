# ========================================
# FLOTTEQ BACKEND - PRODUCTION ENVIRONMENT
# ========================================
# Copier ce fichier en .env.production et remplacer TOUS les CHANGEME

# ========================================
# APPLICATION
# ========================================
NODE_ENV=production
PORT=3000

# ========================================
# DATABASE (PostgreSQL 15)
# ========================================
# Host: Utiliser nom du service Docker (postgres) ou IP externe
DB_HOST=postgres
DB_PORT=5432
DB_USER=flotteq_prod
DB_PASSWORD=CHANGEME_STRONG_PASSWORD_MIN_32_CHARS
DB_NAME=flotteq_production

# URL complète (utilisée par TypeORM dans certains cas)
DATABASE_URL=postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}

# ========================================
# JWT SECRETS
# ========================================
# Générer avec: openssl rand -base64 64
# ⚠️ CRITICAL: Changer TOUS ces secrets en production!

# Access token (15min - courte durée)
JWT_ACCESS_SECRET=CHANGEME_GENERATE_WITH_OPENSSL_RAND_BASE64_64
JWT_ACCESS_EXPIRES=15m

# Refresh token (7 jours)
JWT_REFRESH_SECRET=CHANGEME_GENERATE_WITH_OPENSSL_RAND_BASE64_64
JWT_REFRESH_EXPIRES=7d

# Partner token (7 jours - pour partenaires marketplace)
JWT_PARTNER_SECRET=CHANGEME_GENERATE_WITH_OPENSSL_RAND_BASE64_64
PARTNER_TOKEN_EXPIRY=7d

# ========================================
# CORS ORIGINS
# ========================================
# Ajouter TOUS les domaines autorisés (séparés par virgules)
# ⚠️ PAS DE LOCALHOST EN PRODUCTION!
CORS_ORIGIN=https://app.flotteq.com,https://partner.flotteq.com,https://driver.flotteq.com,https://admin.flotteq.com

# ========================================
# FRONTEND URLs
# ========================================
# Utilisés pour redirection après auth, emails, etc.
FRONTEND_CLIENT_URL=https://app.flotteq.com
FRONTEND_URL=https://app.flotteq.com
PARTNER_FRONTEND_URL=https://partner.flotteq.com
CLIENT_FRONTEND_URL=https://app.flotteq.com

# ========================================
# STRIPE (⚠️ CLÉS LIVE, PAS TEST!)
# ========================================
# Dashboard Stripe: https://dashboard.stripe.com (mode LIVE)
STRIPE_SECRET_KEY=sk_live_CHANGEME_COPY_FROM_STRIPE_DASHBOARD
STRIPE_PUBLISHABLE_KEY=pk_live_CHANGEME_COPY_FROM_STRIPE_DASHBOARD
STRIPE_WEBHOOK_SECRET=whsec_CHANGEME_CREATE_WEBHOOK_FOR_PRODUCTION_URL

# ========================================
# REDIS (Cache + Bull Queue)
# ========================================
# ⚠️ Activer Redis EN PRODUCTION (désactivé en dev)
REDIS_ENABLED=true
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=CHANGEME_STRONG_REDIS_PASSWORD

# Cache TTL en secondes (10 minutes)
CACHE_TTL=600

# ========================================
# EMAIL (SMTP)
# ========================================
# Configuration Gmail, SendGrid, Mailgun, etc.
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=noreply@flotteq.com
SMTP_PASSWORD=CHANGEME_APP_PASSWORD_FROM_GMAIL

# Adresse expéditeur (affiché dans les emails)
EMAIL_FROM=FlotteQ <noreply@flotteq.com>

# ========================================
# FILE UPLOADS
# ========================================
# 10MB max par fichier
MAX_FILE_SIZE=10485760

# Types autorisés
ALLOWED_FILE_TYPES=image/*,application/pdf

# ========================================
# BCRYPT
# ========================================
# Rounds pour hashage (12 = bon compromis sécurité/perf)
BCRYPT_ROUNDS=12

# ========================================
# RATE LIMITING
# ========================================
# Protection brute-force (géré par @nestjs/throttler)
# Déjà configuré dans app.module.ts : 100 req/min global
# Les endpoints sensibles ont des limites spécifiques:
# - /auth/login: 5 req/min
# - /auth/register: 3 req/min

# ========================================
# APPLICATION URL (pour logs, monitoring)
# ========================================
APP_URL=https://api.flotteq.com

# ========================================
# LOGGING
# ========================================
# Niveau: error, warn, log, debug, verbose
LOG_LEVEL=warn

# ========================================
# SENTRY (Optionnel - Error tracking)
# ========================================
# SENTRY_DSN=https://xxxxx@sentry.io/xxxxxx
# SENTRY_ENVIRONMENT=production

# ========================================
# NOTES IMPORTANTES
# ========================================
# 1. Ne JAMAIS commiter ce fichier avec des vraies valeurs
# 2. Générer secrets forts: openssl rand -base64 64
# 3. Stripe: Basculer en mode LIVE (pas test)
# 4. CORS: Ajouter TOUS les domaines (4 frontends)
# 5. Redis: ACTIVER en production (REDIS_ENABLED=true)
# 6. DB: Créer user PostgreSQL dédié (pas 'postgres' root)
# 7. SMTP: Utiliser service transactionnel (SendGrid, Mailgun)
